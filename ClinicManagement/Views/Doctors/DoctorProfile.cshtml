@{ ViewBag.Title = "Dr. " + Model.Doctor.Name + " -Profile"; }

@model ClinicManagement.Core.ViewModel.DoctorDetailViewModel
@using Microsoft.AspNet.Identity
<div class="container">
    <form method="post">
        <div class="row">
            <div class="col-md-4">
                <div class="profile-img">
                    <img class="bshadow" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS52y5aInsxSm31CvHOFHWujqUx_wWTS9iM6s7BAm21oEN_RiGoog" alt="" />
                    <div class="file btn btn-lg btn-primary">
                        <a class="btn btn-outline-light" href="/Doctors/Edit/@Model.Doctor.Id">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                            </svg>
                            Edit Profile
                        </a>
                    </div>

                </div>

                <div class="profile-work ml-1">

                    <p>
                        
                        @if (Model.Doctor.IsAvailable)
                        {
            <div class="btn btn-success btn-block" id="btnAv" data-docid="@Model.Doctor.Id">
                <a><h5 id="lblStatus" class="text-white text-center font-weight-bold">Available</h5></a>
            </div> }
        else
        {
<div id="btnAv" class="btn btn-danger btn-block" data-docid="@Model.Doctor.Id">

    <a><h5 id="lblStatus" class="text-white text-center font-weight-bold"> Not Available</h5></a>
</div>}
                        <br/>
                        <small class="p-1">Tap Here to Change the Status</small>
                    </p>
                </div>
                <h5>DOCTOR DETAILS </h5>
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-start">
                        <h5 class="font-weight-bold text-uppercase">
                            @Model.Doctor.Name
                        </h5>
                        (<h6>@Model.Doctor.Physician.Sex</h6>)
                    </li>
                    <li class="list-group-item d-flex justify-content-start">
                        <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-flower3" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M11.424 8c.437-.052.811-.136 1.04-.268a2 2 0 0 0-2-3.464c-.229.132-.489.414-.752.767C9.886 4.63 10 4.264 10 4a2 2 0 1 0-4 0c0 .264.114.63.288 1.035-.263-.353-.523-.635-.752-.767a2 2 0 0 0-2 3.464c.229.132.603.216 1.04.268-.437.052-.811.136-1.04.268a2 2 0 1 0 2 3.464c.229-.132.489-.414.752-.767C6.114 11.37 6 11.736 6 12a2 2 0 1 0 4 0c0-.264-.114-.63-.288-1.035.263.353.523.635.752.767a2 2 0 1 0 2-3.464c-.229-.132-.603-.216-1.04-.268zM9 4a1 1 0 0 0-2 0 1.473 1.473 0 0 0 .045.206c.039.131.1.294.183.483.166.378.396.808.637 1.223l.135.23.135-.23c.241-.415.47-.845.637-1.223.083-.19.144-.352.183-.484.02-.065.031-.116.038-.154C9 4.018 9 4.002 9 4zM3.67 5.5a1 1 0 0 0 .366 1.366 1.47 1.47 0 0 0 .2.064c.134.032.305.06.51.083.411.045.898.061 1.379.06.09 0 .178 0 .266-.002a21.82 21.82 0 0 0-.131-.232 12.88 12.88 0 0 0-.742-1.163 4.215 4.215 0 0 0-.327-.4 1.472 1.472 0 0 0-.115-.11c-.025-.022-.038-.03-.04-.032A1 1 0 0 0 3.67 5.5zm1.366 5.366a1 1 0 0 1-1-1.732c.001 0 .016-.008.047-.02.037-.013.087-.028.153-.044.134-.032.305-.06.51-.083a12.88 12.88 0 0 1 1.379-.06c.09 0 .178 0 .266.002a21.82 21.82 0 0 1-.131.232c-.24.416-.497.83-.742 1.163a4.1 4.1 0 0 1-.327.4 1.483 1.483 0 0 1-.155.142zM9 12a1 1 0 0 1-2 0 1.476 1.476 0 0 1 .045-.206c.039-.131.1-.294.183-.483.166-.378.396-.808.637-1.223L8 9.858l.135.23c.241.415.47.845.637 1.223.083.19.144.352.183.484A1.338 1.338 0 0 1 9 12zm3.33-6.5a1 1 0 0 1-.366 1.366 1.478 1.478 0 0 1-.2.064c-.134.032-.305.06-.51.083-.412.045-.898.061-1.379.06-.09 0-.178 0-.266-.002l.131-.232c.24-.416.497-.83.742-1.163a4.1 4.1 0 0 1 .327-.4c.046-.05.085-.086.114-.11.026-.022.04-.03.041-.032a1 1 0 0 1 1.366.366zm-1.366 5.366a1 1 0 0 0 1-1.732c-.002 0-.016-.008-.047-.02a1.478 1.478 0 0 0-.153-.044 4.217 4.217 0 0 0-.51-.083 12.881 12.881 0 0 0-1.379-.06c-.09 0-.178 0-.266.002a22 22 0 0 0 .131.232c.24.416.497.83.742 1.163.122.167.232.3.327.4a1.494 1.494 0 0 0 .155.142zM8 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                        </svg>
                        <h6>@Model.Doctor.Specialization.Name</h6>
                    </li>
                    <li class="list-group-item d-flex justify-content-start">
                        <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-file-text" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H4z" />
                            <path fill-rule="evenodd" d="M4.5 10.5A.5.5 0 0 1 5 10h3a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm0-2A.5.5 0 0 1 5 8h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm0-2A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm0-2A.5.5 0 0 1 5 4h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5z" />
                        </svg>
                        <h6>@Model.Doctor.Address</h6>
                    </li>
                    <li class="list-group-item d-flex justify-content-start">
                        <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-phone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M11 1H5a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z" />
                            <path fill-rule="evenodd" d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                        </svg>
                        <h6>@Model.Doctor.Phone</h6>
                    </li>
                    <li class="list-group-item d-flex justify-content-start">
                        <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-phone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M11 1H5a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z" />
                            <path fill-rule="evenodd" d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                        </svg>
                        <h6>@Model.Doctor.Physician.Email</h6>
                    </li>

                </ul>
            </div>
            <div class="col-md-8">
                <div class="profile-head">

                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Today's Appointments</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">All Appointments</a>
                        </li>
                    </ul>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="tab-content profile-tab" id="myTabContent">
                            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                @if (Model.UpcomingAppointments.Count() == 0)
                                {
                    @Html.Partial("_NoData")}
                                <table class="table table-borderless table-hover table-striped table-responsive-sm">
                                    <thead>
                                        <tr>
                                            <th>Token</th>
                                            <th>Patient Name</th>
                                            <th>Phone</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Doctor</th>
                                            <th>Detail</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var appt in Model.UpcomingAppointments)
                                        {
                            <tr>
                                <td>@appt.Patient.Token</td>
                                <td>@appt.Patient.Name</td>
                                <td>@appt.Patient.Phone</td>
                                <td>@appt.StartDateTime.ToString("dd/MM/yyyy")</td>
                                <td>@appt.StartDateTime.ToString("HH:mm")</td>
                                <td>@appt.Doctor.Name</td>
                                <td>@appt.Detail</td>
                                @if (appt.Status)
                                {
                <td>
                    <div class="badge-available text-center font-weight-bold text-success">
                        Approved
                    </div>
                </td> }
                                else
                                {
                <td>
                    <div class="badge-notavailable text-center font-weight-bold text-danger">
                        Pending
                    </div>
                </td>
}
                                <td>
                                    <a class="btn btn-secondary" href="/Appointments/Details/@appt.Id">View Details</a>
                                </td>
                            </tr>}
                                    </tbody>
                                </table>

                            </div>
                            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                <input type="hidden" value="0" id="isEmpty" />
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>


    </form>
</div>
@section scripts
{
    <script>
        $(document).ready(function () {
            $("#profile-tab").click(function () {
                console.log($("#profile").html());
                if ($("#isEmpty").val() == 0) {
                    $.ajax({
                        url: "/Appointments/AllDocAppts",
                        contentType: "application/html",
                        type: "GET",
                        beforeSend: function () {
                            toastr.info("Getting all Appointments!")
                        },
                        success: function (result) {

                            $("#profile").html(result);
                            $("#isEmpty").val(1);
                        },
                        error: function (xhr) {
                            toastr.error("Error Occured!!");
                        }
                    });
                }


                //console.log($("#profile").html());
            });
            $("#btnAv").click(function () {
                var button = this;
                $.ajax({
                    url: "/Doctors/ToggleAvail/" + button.getAttribute("data-docid"),
                    type: "POST",
                    contentType: "application/json",
                    beforeSend() {

                    },
                    success(result) {

                        
                        var st = $("#lblStatus").text();
                        if (st == "Available") {
                            $("#lblStatus").text("Not Available");
                            $(".btn-success").removeClass("btn-success").addClass("btn-danger");
                        }
                        else {
                            $("#lblStatus").text("Available");
                            $(".btn-danger").removeClass("btn-danger").addClass("btn-success");
                        }
                        
                    },
                    complete() { },
                    error(err) {
                        toastr.error("Error Sending Request!"+err);
                    }
                });
            });
        });
    </script>
}